function Q(){return Q=Object.assign?Object.assign.bind():function(h){for(var f=1;f<arguments.length;f++){var a=arguments[f];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(h[r]=a[r])}return h},Q.apply(this,arguments)}var Y=function(f,a){return f.querySelector(a)},$t=function(f,a){return f.querySelectorAll(a)},Xt=function(f){f===void 0&&(f={});var a={};return Object.keys(f).forEach(function(r){typeof f[r]<"u"&&(a[r]=f[r])}),a},Yt={alwaysActive:!1,activeOffset:50,shadowOffset:50,shadowScale:1,duration:300,rotate:!0,rotateTouch:!0,rotateXMax:15,rotateYMax:15,rotateXInvert:!1,rotateYInvert:!1,stretchX:0,stretchY:0,stretchZ:0,commonOrigin:!0,shadow:!0,highlight:!0};function Tt(h){h===void 0&&(h={});var f=h,a=f.el,r=f.eventsEl,at=h,rt=at.isComponent,N,m={__atropos__:!0,params:Q({},Yt,{onEnter:null,onLeave:null,onRotate:null},Xt(h||{})),destroyed:!1,isActive:!1},e=m.params,M,T,U,A,b,l,c,P,j,z,g=[],G,ot=function n(){G=requestAnimationFrame(function(){g.forEach(function(t){if(typeof t=="function")t();else{var o=t.element,i=t.prop,s=t.value;o.style[i]=s}}),g.splice(0,g.length),n()})};ot();var O=function(t,o){g.push({element:t,prop:"transitionDuration",value:o})},x=function(t,o){g.push({element:t,prop:"transitionTimingFunction",value:o})},y=function(t,o){g.push({element:t,prop:"transform",value:o})},S=function(t,o){g.push({element:t,prop:"opacity",value:o})},nt=function(t,o){g.push({element:t,prop:"transformOrigin",value:o})},$=function(t,o,i,s){return t.addEventListener(o,i,s)},X=function(t,o,i,s){return t.removeEventListener(o,i,s)},it=function(){var t;l=Y(a,".atropos-shadow"),l||(l=document.createElement("span"),l.classList.add("atropos-shadow"),t=!0),y(l,"translate3d(0,0,-"+e.shadowOffset+"px) scale("+e.shadowScale+")"),t&&M.appendChild(l)},st=function(){var t;c=Y(a,".atropos-highlight"),c||(c=document.createElement("span"),c.classList.add("atropos-highlight"),t=!0),y(c,"translate3d(0,0,0)"),t&&U.appendChild(c)},Z=function(t){var o=t.rotateXPercentage,i=o===void 0?0:o,s=t.rotateYPercentage,u=s===void 0?0:s,p=t.duration,_=t.opacityOnly,E=t.easeOut,R=function(d){if(d.dataset.atroposOpacity&&typeof d.dataset.atroposOpacity=="string")return d.dataset.atroposOpacity.split(";").map(function(w){return parseFloat(w)})};$t(N,"[data-atropos-offset], [data-atropos-opacity]").forEach(function(v){O(v,p),x(v,E?"ease-out":"");var d=R(v);if(i===0&&u===0)_||y(v,"translate3d(0, 0, 0)"),d&&S(v,d[0]);else{var w=parseFloat(v.dataset.atroposOffset)/100;if(!Number.isNaN(w)&&!_&&y(v,"translate3d("+-u*-w+"%, "+i*-w+"%, 0)"),d){var F=d[0],B=d[1],H=Math.max(Math.abs(i),Math.abs(u));S(v,F+(B-F)*H/100)}}})},k=function(t,o){var i=a!==r;if(A||(A=a.getBoundingClientRect()),i&&!b&&(b=r.getBoundingClientRect()),typeof t>"u"&&typeof o>"u"){var s=i?b:A;t=s.left+s.width/2,o=s.top+s.height/2}var u=0,p=0,_=A,E=_.top,R=_.left,v=_.width,d=_.height,w;if(i){var q=b,tt=q.top,et=q.left,vt=q.width,dt=q.height,lt=R-et,ht=E-tt,mt=v/2+lt,gt=d/2+ht,yt=t-et,Mt=o-tt;p=e.rotateYMax*(yt-mt)/(vt-v/2)*-1,u=e.rotateXMax*(Mt-gt)/(dt-d/2),w=t-R+"px "+(o-E)+"px"}else{var F=v/2,B=d/2,H=t-R,pt=o-E;p=e.rotateYMax*(H-F)/(v/2)*-1,u=e.rotateXMax*(pt-B)/(d/2)}u=Math.min(Math.max(-u,-e.rotateXMax),e.rotateXMax),e.rotateXInvert&&(u=-u),p=Math.min(Math.max(-p,-e.rotateYMax),e.rotateYMax),e.rotateYInvert&&(p=-p);var D=u/e.rotateXMax*100,C=p/e.rotateYMax*100,Ot=(i?C/100*e.stretchX:0)*(e.rotateYInvert?-1:1),xt=(i?D/100*e.stretchY:0)*(e.rotateXInvert?-1:1),wt=i?Math.max(Math.abs(D),Math.abs(C))/100*e.stretchZ:0;y(M,"translate3d("+Ot+"%, "+-xt+"%, "+-wt+"px) rotateX("+u+"deg) rotateY("+p+"deg)"),w&&e.commonOrigin&&nt(M,w),c&&(O(c,e.duration+"ms"),x(c,"ease-out"),y(c,"translate3d("+-C*.25+"%, "+D*.25+"%, 0)"),S(c,Math.max(Math.abs(D),Math.abs(C))/100)),Z({rotateXPercentage:D,rotateYPercentage:C,duration:e.duration+"ms",easeOut:!0}),typeof e.onRotate=="function"&&e.onRotate(u,p)},J=function(){g.push(function(){return a.classList.add("atropos-active")}),O(M,e.duration+"ms"),x(M,"ease-out"),y(T,"translate3d(0,0, "+e.activeOffset+"px)"),O(T,e.duration+"ms"),x(T,"ease-out"),l&&(O(l,e.duration+"ms"),x(l,"ease-out")),m.isActive=!0},I=function(t){if(P=void 0,!(t.type==="pointerdown"&&t.pointerType==="mouse")&&!(t.type==="pointerenter"&&t.pointerType!=="mouse")){if(t.type==="pointerdown"&&t.preventDefault(),j=t.clientX,z=t.clientY,e.alwaysActive){A=void 0,b=void 0;return}J(),typeof e.onEnter=="function"&&e.onEnter()}},K=function(t){P===!1&&t.cancelable&&t.preventDefault()},V=function(t){if(!(!e.rotate||!m.isActive)){if(t.pointerType!=="mouse"){if(!e.rotateTouch)return;t.preventDefault()}var o=t.clientX,i=t.clientY,s=o-j,u=i-z;if(typeof e.rotateTouch=="string"&&(s!==0||u!==0)&&typeof P>"u"){if(s*s+u*u>=25){var p=Math.atan2(Math.abs(u),Math.abs(s))*180/Math.PI;P=e.rotateTouch==="scroll-y"?p>45:90-p>45}P===!1&&(a.classList.add("atropos-rotate-touch"),t.cancelable&&t.preventDefault())}t.pointerType!=="mouse"&&P||k(o,i)}},L=function(t){if(A=void 0,b=void 0,!!m.isActive&&!(t&&t.type==="pointerup"&&t.pointerType==="mouse")&&!(t&&t.type==="pointerleave"&&t.pointerType!=="mouse")){if(typeof e.rotateTouch=="string"&&P&&a.classList.remove("atropos-rotate-touch"),e.alwaysActive){k(),typeof e.onRotate=="function"&&e.onRotate(0,0),typeof e.onLeave=="function"&&e.onLeave();return}g.push(function(){return a.classList.remove("atropos-active")}),O(T,e.duration+"ms"),x(T,""),y(T,"translate3d(0,0, 0px)"),l&&(O(l,e.duration+"ms"),x(l,"")),c&&(O(c,e.duration+"ms"),x(c,""),y(c,"translate3d(0, 0, 0)"),S(c,0)),O(M,e.duration+"ms"),x(M,""),y(M,"translate3d(0,0,0) rotateX(0deg) rotateY(0deg)"),Z({duration:e.duration+"ms"}),m.isActive=!1,typeof e.onRotate=="function"&&e.onRotate(0,0),typeof e.onLeave=="function"&&e.onLeave()}},W=function(t){var o=t.target;!r.contains(o)&&o!==r&&m.isActive&&L()},ut=function(){typeof a=="string"&&(a=Y(document,a)),a&&(a.__atropos__||(typeof r<"u"?typeof r=="string"&&(r=Y(document,r)):r=a,N=rt?a.parentNode.host:a,Object.assign(m,{el:a}),M=Y(a,".atropos-rotate"),T=Y(a,".atropos-scale"),U=Y(a,".atropos-inner"),a.__atropos__=m))},ft=function(){ut(),!(!a||!r)&&(e.shadow&&it(),e.highlight&&st(),e.rotateTouch&&(typeof e.rotateTouch=="string"?a.classList.add("atropos-rotate-touch-"+e.rotateTouch):a.classList.add("atropos-rotate-touch")),Y(N,"[data-atropos-opacity]")&&Z({opacityOnly:!0}),$(document,"click",W),$(r,"pointerdown",I),$(r,"pointerenter",I),$(r,"pointermove",V),$(r,"touchmove",K),$(r,"pointerleave",L),$(r,"pointerup",L),$(r,"lostpointercapture",L),e.alwaysActive&&(J(),k()))},ct=function(){m.destroyed=!0,cancelAnimationFrame(G),X(document,"click",W),X(r,"pointerdown",I),X(r,"pointerenter",I),X(r,"pointermove",V),X(r,"touchmove",K),X(r,"pointerleave",L),X(r,"pointerup",L),X(r,"lostpointercapture",L),delete a.__atropos__};return m.destroy=ct,ft(),m}export{Tt as A};
